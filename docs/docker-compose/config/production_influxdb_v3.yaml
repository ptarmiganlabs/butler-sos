---
Butler-SOS:
    logLevel: info
    fileLogging: true
    logDirectory: log
    systemInfo:
        enable: true
    anonTelemetry: true
    configVisualisation:
        enable: true
        host: 0.0.0.0
        port: 3100
        obfuscate: true

    # Audit events API
    # Receives audit events from the Butler SOS audit extension running in the browser.
    # Calls are authenticated using a simple bearer token (see apiToken), and CORS must be configured.
    auditEvents:
        enable: false
        host: 0.0.0.0 # IP/FQDN to bind to. Use 0.0.0.0 to listen on all interfaces.
        port: 8181
        apiToken: '' # Recommended: set a strong token and configure the same token in the extension.

        # Destination(s) for audit events.
        # This is intentionally separate from Butler-SOS.influxdbConfig so audit data can be stored in a separate
        # InfluxDB instance/version/database/bucket than other Butler SOS metrics.
        destination:
            enable: false # Set to true to store incoming audit events in one or more destinations.
            type: influxdb # Comma-delimited list of destinations. Valid values: influxdb, parquet, qvd.
            influxdb:
                host: influxdb-v3-core
                port: 8181
                version: 3 # 1 | 2 | 3
                maxBatchSize: 1000 # Flush immediately when this many audit events are buffered.
                writeFrequency: 20000 # Flush buffered audit events this often (ms). Use 0 to write immediately per event.
                measurementName: audit_event # Single measurement for all audit events.
                auditEventSchemaVersion: '1' # Stored as tag auditEventSchemaVersion.
                staticTags: # Optional static tags added to all audit event points.
                    - name: qs_env
                      value: docker-v3

                # Settings for InfluxDB v3.x only, i.e. Butler-SOS.auditEvents.destination.influxdb.version=3
                v3Config:
                    database: butler-sos
                    description: Butler SOS metrics
                    token: apiv3_99RtQcbFuBYP_wO1fK5aHvIBQqOqOVRAV4cAqAJxm_gpQRUFIpQkONXWfG0cBt_1wOI21Dc2l5K2izMa3gW7mA
                    retentionDuration: 10d
                    writeTimeout: 10000

                # Settings for InfluxDB v2.x only, i.e. Butler-SOS.auditEvents.destination.influxdb.version=2
                v2Config:
                    org: myorg
                    bucket: mybucket
                    description: Butler SOS metrics
                    token: mytoken
                    retentionDuration: 10d

                # Settings below are for InfluxDB v1.x only, i.e. Butler-SOS.auditEvents.destination.influxdb.version=1
                v1Config:
                    auth:
                        enable: false
                        username: ''
                        password: ''
                    dbName: senseops
                    retentionPolicy:
                        name: 10d
                        duration: 10d

            parquet:
                exportDirectory: audit-events/parquet # Directory where Parquet files will be stored.
                maxBatchSize: 1000 # Flush immediately when this many audit events are buffered.
                writeFrequency: 20000 # Flush buffered audit events this often (ms). Use 0 to write immediately per event.
                staticTags: # Optional static tags added to all audit event points.
                    - name: qs_env
                      value: docker-v3

            qvd:
                exportDirectory: audit-events/qvd # Directory where QVD files will be stored.
                maxBatchSize: 1000 # Flush immediately when this many audit events are buffered.
                writeFrequency: 20000 # Flush buffered audit events this often (ms). Use 0 to write immediately per event.
                staticTags: # Optional static tags added to all audit event points.
                    - name: qs_env
                      value: docker-v3

        # Optional: serve the audit events API over HTTPS.
        # This is required if the Qlik Sense client is served over HTTPS, otherwise browsers will block calls to an HTTP endpoint (mixed content).
        # Note: if you use a self-signed certificate, the browser must trust it (import into OS/browser trust store).
        # There is no way for a client-side Qlik Sense extension to bypass TLS validation for fetch() calls.
        tls:
            enable: false
            cert: /nodeapp/config/certificate/server.crt
            key: /nodeapp/config/certificate/server.key
            # ca: /nodeapp/config/certificate/root.pem
            # passphrase: <optional key passphrase>
        # Message queue settings for handling incoming HTTP audit events
        queue:
            messageQueue:
                maxConcurrent: 10 # Max number of messages being processed simultaneously (default: 10)
                maxSize: 200 # Max queue size before messages are dropped (default: 200)
                backpressureThreshold: 80 # Warn when queue utilization reaches this % (default: 80)
            # Rate limiting to prevent message flooding (in addition to HTTP rate limiting)
            rateLimit:
                enable: false # Enable rate limiting (default: false)
                maxMessagesPerMinute: 600 # Max messages per minute, ~10/sec (default: 600)
            # Queue metrics storage in InfluxDB
            queueMetrics:
                influxdb:
                    enable: false # Store queue metrics in InfluxDB (default: false)
                    writeFrequency: 20000 # How often to write metrics, milliseconds (default: 20000)
                    measurementName: audit_events_queue # InfluxDB measurement name (default: audit_events_queue)
                    tags: # Optional tags added to queue metrics
                        - name: qs_env
                          value: docker-v3
        # Optional: download screenshots referenced by screenshot.url.received events.
        # Multiple storage targets can be enabled at the same time.
        screenshots:
            enable: false
            downloadTimeoutMs: 15000
            # Optional: add a metadata header above downloaded PNG screenshots.
            # Enabled fields are rendered as text into the image itself.
            # When date is enabled, both UTC and server-local time are shown.
            addInImageMetadata:
                date: false # Date and time when the screenshot was taken.
                eventId: false # Unique event identifier.
                correlationId: false # Correlation ID to link related events.
                selectionTxnId: false # Selection transaction ID.
                userId: false # Full user identifier as provided by the audit event (often DOMAIN\\user).
                appId: false # App ID (GUID).
                appName: false # App name.
                sheetName: false # Sheet name.
                viewingDuration: false # Duration the object was in view before the screenshot was taken (seconds).
            # Optional: authenticate screenshot downloads against Qlik Sense using a QPS ticket (mutual TLS).
            # Certificates are reused from Butler-SOS.cert.*
            # TLS server certificate verification is controlled via Butler-SOS.serversToMonitor.rejectUnauthorized.
            auth:
                mode: none # none | qpsTicket
                qps:
                    host: localhost
                    port: 4243
                    userDirectory: ''
                    userId: ''
                    ticketTimeoutMs: 5000
            storageTargets:
                - enable: true
                  type: flat
                  directory: screenshots/audit
        cors:
            allowedOrigins:
                - '*'
    heartbeat:
        enable: false
        remoteURL: http://localhost
        frequency: every 1 hour
    dockerHealthCheck:
        enable: true
        port: 12398
    uptimeMonitor:
        enable: true
        frequency: every 15 seconds
        logLevel: verbose
        storeInInfluxdb:
            butlerSOSMemoryUsage: true
            instanceTag: docker-v3
        storeNewRelic:
            enable: false
            destinationAccount: []
            metric:
                dynamic:
                    butlerMemoryUsage:
                        enable: false
                    butlerUptime:
                        enable: false
            attribute:
                static: []
                dynamic:
                    butlerVersion:
                        enable: false
    qlikSenseEvents:
        influxdb:
            enable: true
            writeFrequency: 5000
        eventCount:
            enable: true
            influxdb:
                measurementName: event_count
                tags:
                    - name: qs_env
                      value: docker-v3
        rejectedEventCount:
            enable: false
            influxdb:
                measurementName: rejected_event_count
    influxdbConfig:
        enable: true
        host: influxdb-v3-core
        port: 8181
        version: 3
        maxBatchSize: 100
        v3Config:
            database: butler-sos
            description: Butler SOS metrics
            token: apiv3_99RtQcbFuBYP_wO1fK5aHvIBQqOqOVRAV4cAqAJxm_gpQRUFIpQkONXWfG0cBt_1wOI21Dc2l5K2izMa3gW7mA
            retentionDuration: 10d
            writeTimeout: 10000
            queryTimeout: 60000
        v2Config:
            org: myorg
            bucket: mybucket
            description: Butler SOS metrics
            token: mytoken
            retentionDuration: 10d
        v1Config:
            auth:
                enable: false
                username: ''
                password: ''
            dbName: senseops
            retentionPolicy:
                name: 10d
                duration: 10d
        includeFields:
            activeDocs: false
            loadedDocs: false
            inMemoryDocs: false
    serversToMonitor:
        pollingInterval: 30000
        rejectUnauthorized: false
        serverTagsDefinition: []
        servers: []
    thirdPartyToolsCredentials:
        newRelic: []
    userEvents:
        enable: false
        excludeUser: []
        udpServerConfig:
            serverHost: 0.0.0.0
            portUserActivityEvents: 9997
            messageQueue:
                maxConcurrent: 10
                maxSize: 200
                backpressureThreshold: 80
            rateLimit:
                enable: false
                maxMessagesPerMinute: 600
            maxMessageSize: 65507
            queueMetrics:
                influxdb:
                    enable: false
                    writeFrequency: 20000
                    measurementName: user_events_queue
                    tags: []
        tags: []
        sendToMQTT:
            enable: false
            postTo:
                everythingTopic:
                    enable: false
                    topic: qliksense/userevent
                sessionStartTopic:
                    enable: false
                    topic: qliksense/userevent/session/start
                sessionStopTopic:
                    enable: false
                    topic: qliksense/userevent/session/stop
                connectionOpenTopic:
                    enable: false
                    topic: qliksense/userevent/connection/open
                connectionCloseTopic:
                    enable: false
                    topic: qliksense/userevent/connection/close
        sendToInfluxdb:
            enable: false
        sendToNewRelic:
            enable: false
            destinationAccount: []
            scramble: true
    logEvents:
        udpServerConfig:
            serverHost: 0.0.0.0
            portLogEvents: 9996
            messageQueue:
                maxConcurrent: 10
                maxSize: 200
                backpressureThreshold: 80
            rateLimit:
                enable: false
                maxMessagesPerMinute: 600
            maxMessageSize: 65507
            queueMetrics:
                influxdb:
                    enable: false
                    writeFrequency: 20000
                    measurementName: log_events_queue
                    tags: []
        tags: []
        source:
            engine:
                enable: false
            proxy:
                enable: false
            repository:
                enable: false
            scheduler:
                enable: false
            qixPerf:
                enable: false
        categorise:
            enable: false
            rules: []
            ruleDefault:
                enable: false
                category: []
        enginePerformanceMonitor:
            enable: false
            appNameLookup:
                enable: false
            trackRejectedEvents:
                enable: false
                tags: []
            monitorFilter:
                allApps:
                    enable: false
                    appExclude: []
                    objectType:
                        allObjectTypes: true
                        allObjectTypesExclude: []
                        someObjectTypesInclude: []
                    method:
                        allMethods: true
                        allMethodsExclude: []
                        someMethodsInclude: []
                appSpecific:
                    enable: false
                    app: []
        sendToMQTT:
            enable: false
            baseTopic: qliksense/logevent
            postTo:
                baseTopic: true
                subsystemTopics: true
        sendToInfluxdb:
            enable: false
        sendToNewRelic:
            enable: false
            destinationAccount: []
            source:
                engine:
                    enable: false
                    logLevel:
                        error: true
                        warn: true
                proxy:
                    enable: false
                    logLevel:
                        error: true
                        warn: true
                repository:
                    enable: false
                    logLevel:
                        error: true
                        warn: true
                scheduler:
                    enable: false
                    logLevel:
                        error: true
                        warn: true
    cert:
        clientCert: /nodeapp/config/certificate/client.pem
        clientCertKey: /nodeapp/config/certificate/client_key.pem
        clientCertCA: /nodeapp/config/certificate/root.pem
        clientCertPassphrase: ''
    mqttConfig:
        enable: false
        brokerHost: localhost
        brokerPort: 1883
        baseTopic: butler-sos/
    newRelic:
        enable: false
        event:
            url: https://insights-collector.eu01.nr-data.net
            header: []
            attribute:
                static: []
                dynamic:
                    butlerSosVersion:
                        enable: false
        metric:
            destinationAccount: []
            url: https://insights-collector.eu01.nr-data.net/metric/v1
            header: []
            dynamic:
                engine:
                    memory:
                        enable: false
                    cpu:
                        enable: false
                    calls:
                        enable: false
                    selections:
                        enable: false
                    sessions:
                        enable: false
                    users:
                        enable: false
                    saturated:
                        enable: false
                apps:
                    docCount:
                        enable: false
                    activeDocs:
                        enable: false
                    loadedDocs:
                        enable: false
                    inMemoryDocs:
                        enable: false
                cache:
                    cache:
                        enable: false
                proxy:
                    sessions:
                        enable: false
            attribute:
                static: []
                dynamic:
                    butlerSosVersion:
                        enable: false
    prometheus:
        enable: false
        host: 0.0.0.0
        port: 9842
    appNames:
        enableAppNameExtract: false
        extractInterval: 60000
        hostIP: localhost
    userSessions:
        enableSessionExtract: false
        pollingInterval: 30000
        excludeUser: []
